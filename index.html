<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Responsive Snake Game</title>
<style>
  html,body {height:100%;margin:0;}
  #game {display:block;width:100vw;height:100vh;touch-action:none;}
  #overlay {position:fixed;inset:0;display:grid;place-items:center;background:rgba(0,0,0,.35);}
  .panel {background:#fff;padding:16px 20px;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,.25);}
  #dpad {position:fixed;bottom:16px;left:50%;transform:translateX(-50%);display:grid;gap:6px}
  #dpad button {font-size:18px;padding:10px 14px}
  @media (min-width:900px){ #dpad{display:none} }
</style>
</head>
<body>
<canvas id="game"></canvas>

<div id="overlay" hidden>
  <div class="panel">
    <h2 id="statusText">Paused</h2>
    <button id="startBtn">Start / Restart</button>
  </div>
</div>

<div id="dpad">
  <button data-dir="up">▲</button>
  <div>
    <button data-dir="left">◀</button>
    <button data-dir="down">▼</button>
    <button data-dir="right">▶</button>
  </div>
</div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const overlay = document.getElementById('overlay');
const statusText = document.getElementById('statusText');
const startBtn = document.getElementById('startBtn');

let rafId = null;
let tickMs = 120;
let lastTick = 0;
let running = false;

let snake, dir, nextDir, food, grid, score;

function resetGame() {
  grid = 24;
  snake = [{x:12, y:12}];
  dir = {x:1, y:0};
  nextDir = {x:1, y:0};
  food = spawnFood();
  score = 0;
  lastTick = 0;
  tickMs = 120;
}

function spawnFood() {
  while (true) {
    const f = { x: rand(grid), y: rand(grid) };
    if (!snake.some(s => s.x===f.x && s.y===f.y)) return f;
  }
}
function rand(n) { return Math.floor(Math.random()*n); }

function resizeCanvas() {
  const dpr = Math.max(1, window.devicePixelRatio || 1);
  const cssW = window.innerWidth;
  const cssH = window.innerHeight;
  canvas.style.width = cssW + 'px';
  canvas.style.height = cssH + 'px';
  canvas.width = Math.floor(cssW * dpr);
  canvas.height = Math.floor(cssH * dpr);
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
window.addEventListener('resize', resizeCanvas);

function onKey(e){
  const k = e.key.toLowerCase();
  if (k==='arrowup'||k==='w') turn(0,-1);
  else if (k==='arrowdown'||k==='s') turn(0,1);
  else if (k==='arrowleft'||k==='a') turn(-1,0);
  else if (k==='arrowright'||k==='d') turn(1,0);
}
function turn(x,y){
  if (x===-dir.x && y===-dir.y) return;
  nextDir = {x,y};
}

document.getElementById('dpad').addEventListener('touchstart', (e)=>{
  const btn = e.target.closest('button');
  if (!btn) return;
  e.preventDefault();
  const d = btn.dataset.dir;
  if (d==='up') turn(0,-1);
  if (d==='down') turn(0,1);
  if (d==='left') turn(-1,0);
  if (d==='right') turn(1,0);
}, {passive:false});

let touchStart = null;
canvas.addEventListener('touchstart', e => { touchStart = getPoint(e); }, {passive:true});
canvas.addEventListener('touchend', e => {
  if (!touchStart) return;
  const p = getPoint(e);
  const dx = p.x - touchStart.x, dy = p.y - touchStart.y;
  if (Math.abs(dx) > Math.abs(dy)) turn(Math.sign(dx), 0);
  else turn(0, Math.sign(dy));
  touchStart = null;
});
function getPoint(e){ const t = e.changedTouches[0]; return {x:t.clientX, y:t.clientY}; }

function loop(ts){
  if (!running) return;
  rafId = requestAnimationFrame(loop);
  if (ts - lastTick < tickMs) return;
  lastTick = ts;
  step();
  draw();
}

function step(){
  dir = nextDir;
  const head = { x: snake[0].x + dir.x, y: snake[0].y + dir.y };

  if (head.x < 0 || head.y < 0 || head.x >= grid || head.y >= grid) return gameOver();
  if (snake.some(s => s.x===head.x && s.y===head.y)) return gameOver();

  snake.unshift(head);

  if (head.x===food.x && head.y===food.y) {
    food = spawnFood();
    score++;
    if (tickMs > 60) tickMs -= 2;
  } else {
    snake.pop();
  }
}

function draw(){
  const cell = Math.floor(Math.min(canvas.clientWidth, canvas.clientHeight) / grid);
  ctx.clearRect(0,0,canvas.clientWidth,canvas.clientHeight);

  ctx.fillStyle = '#e74c3c';
  ctx.fillRect(food.x*cell, food.y*cell, cell, cell);

  ctx.fillStyle = '#2ecc71';
  snake.forEach(s => ctx.fillRect(s.x*cell, s.y*cell, cell, cell));

  ctx.fillStyle = '#111';
  ctx.font = '16px system-ui, -apple-system, sans-serif';
  ctx.fillText(`Score: ${score}`, 8, 20);
}

function gameOver(){
  stopGame();
  statusText.textContent = `Game Over — Score ${score}`;
  overlay.hidden = false;
}

function startGame(){
  if (running) return;
  running = true;
  overlay.hidden = true;
  lastTick = 0;
  rafId = requestAnimationFrame(loop);
}

function stopGame(){
  running = false;
  if (rafId) cancelAnimationFrame(rafId);
  rafId = null;
}

function init(){
  resizeCanvas();
  resetGame();
  draw();
  document.addEventListener('keydown', onKey, {once:false});
  startBtn.addEventListener('click', ()=>{
    resetGame();
    startGame();
  });
  overlay.hidden = false;
  statusText.textContent = 'Ready';
}
init();
</script>
</body>
</html>
